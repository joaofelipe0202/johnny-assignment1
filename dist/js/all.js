const streets=document.querySelector(".streets"),info=document.querySelector("tbody"),streetTitleName=document.querySelector("#street-name"),getStreets=e=>fetch(`https://api.winnipegtransit.com/v3/streets.json?api-key=cmZaYN5yrwwmepOUIVTd&name=${e}`).then((e=>e.json())),getBusStopInfo=e=>fetch(`https://api.winnipegtransit.com/v3/stops.json?api-key=cmZaYN5yrwwmepOUIVTd&street=${e}`).then((e=>{if(e.ok)return e.json();Promise.reject({response:e.status,response:e.statusText})})).then((e=>{const t=[];e.stops.forEach((e=>{t.push(fetch(`https://api.winnipegtransit.com/v3/stops/${e.key}/schedule.json?api-key=cmZaYN5yrwwmepOUIVTd`).then((e=>{if(e.ok)return e.json();Promise.reject({response:e.status,response:e.statusText})})).then((e=>e["stop-schedule"])))})),Promise.all(t).then((t=>{showSchedules(t),updateBusStopTitle(e)}))})),returnStreetName=e=>{0===e.length?streets.innerHTML="No Streets found":e.forEach((e=>{streets.insertAdjacentHTML("afterbegin",`<a href="#" data-street-key="${e.key}">${e.name}</a>`)}))},updateBusStopTitle=e=>{if(void 0!==e.stops[0]){let t=e.stops[0].street.name;streetTitleName.innerHTML=`Displaying results for ${t}`}else streetTitleName.innerHTML="No bus stops to that street name"},nextBusTime=e=>new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!0}),showSchedules=e=>{e.forEach((e=>{e["route-schedules"].forEach((t=>{t["scheduled-stops"].forEach((s=>{info.insertAdjacentHTML("afterbegin",`<tr>\n          <td>${e.stop.street.name}</td>\n          <td>${e.stop["cross-street"].name}</td>\n          <td>${e.stop.direction}</td>\n          <td>${t.route.number}</td>\n          <td>${nextBusTime(s.times.arrival.estimated)}</td>\n        </tr>`)}))}))}))},search=document.querySelector("input"),searchForm=document.querySelector("aside");searchForm.addEventListener("submit",(e=>{let t=search.value;var s;(s=t,fetch(`https://api.winnipegtransit.com/v3/streets.json?api-key=cmZaYN5yrwwmepOUIVTd&name=${s}`).then((e=>e.json()))).then((e=>{var t;0===(t=e.streets).length?streets.innerHTML="No Streets found":t.forEach((e=>{streets.insertAdjacentHTML("afterbegin",`<a href="#" data-street-key="${e.key}">${e.name}</a>`)}))})),search.value="",streets.innerHTML="",e.preventDefault()})),streets.addEventListener("click",(e=>{var t;"A"===e.target.nodeName&&(info.innerHTML="",t=e.target.dataset.streetKey,fetch(`https://api.winnipegtransit.com/v3/stops.json?api-key=cmZaYN5yrwwmepOUIVTd&street=${t}`).then((e=>{if(e.ok)return e.json();Promise.reject({response:e.status,response:e.statusText})})).then((e=>{const t=[];e.stops.forEach((e=>{t.push(fetch(`https://api.winnipegtransit.com/v3/stops/${e.key}/schedule.json?api-key=cmZaYN5yrwwmepOUIVTd`).then((e=>{if(e.ok)return e.json();Promise.reject({response:e.status,response:e.statusText})})).then((e=>e["stop-schedule"])))})),Promise.all(t).then((t=>{showSchedules(t),updateBusStopTitle(e)}))})))}));